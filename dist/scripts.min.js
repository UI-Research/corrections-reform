function wrap(t,a){t.each(function(){for(var t,e=d3.select(this),r=e.text().split(/\s+/).reverse(),n=[],i=0,o=1.1,c=e.attr("y"),s=parseFloat(e.attr("dy")),l=e.text(null).append("tspan").attr("x",0).attr("y",c).attr("dy",s+"em");t=r.pop();)n.push(t),l.text(n.join(" ")),l.node().getComputedTextLength()>a&&(n.pop(),l.text(n.join(" ")),n=[t],l=e.append("tspan").attr("x",0).attr("y",c).attr("dy",++i*o+s+"em").text(t))})}function wrap2(t,a,e){t.each(function(){var t,r=d3.select(this),n=r.text().split(/\s+/).reverse(),i=[],o=0,c=1.1,s=r.attr("y"),l=1.2*c;for(tspan=r.text(null).append("tspan").attr("x",e).attr("y",s).attr("dy",l+"em");t=n.pop();)i.push(t),tspan.text(i.join(" ")),tspan.node().getComputedTextLength()>a&&(i.pop(),tspan.text(i.join(" ")),i=[t],tspan=r.append("tspan").attr("x",e).attr("y",s).attr("dy",++o*c+l+"em").text(t))})}function graph1(){function t(){var t=["standing","pop_total"],a=["Federally sentenced population","Total federal prison population"];data=data_main.growth;var e=d3.scale.linear().range([0,o]).domain(d3.extent(data,function(t){return t.year})),r=d3.scale.linear().range([c,0]).domain([0,22e4]);s.append("text").attr("class","footnote graph0").attr("text-anchor","start").attr("x",0).attr("y",c+30).text(FOOTNOTE).call(wrap2,o+40,-40).attr("opacity",1);var n=d3.svg.line().interpolate("cardinal").defined(function(t){return null!=t.number&t.number>0}).x(function(t){return e(t.year)}).y(function(t){return r(t.number)}),i=t.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),l=s.selectAll(".lines").data(i).enter().append("g").attr("class","lines0");l.append("path").attr("class",function(t){return t.name+" graph0 chartline"}).attr("d",function(t){return n(t.values)}).attr("opacity",1),l.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-3]}}).attr("class","pointlabel graph0").attr("text-anchor","end").attr("x",e(2016)).attr("y",function(t){return"pop_total"==t.name?r(t.value.number)-30:r(15e4)+12}).text(function(t,e){return a[e]}).attr("opacity",1).call(wrap2,.5*o,o),dispatch.on("rescaleStandingLine",function(t,a){e.domain([t,a]),d3.select(".graph0.standing.chartline").attr("opacity",1).transition().duration(1e3).attr("d",function(t){return n(t.values)})})}function a(){data=data_main.sentences.filter(function(t){return"total"==t.offense});var t=["standing","admissions"],a=["Federally sentenced population","Admissions"],e=d3.scale.linear().domain([0,22e4]).range([c,0],.1),r=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,o]),n=d3.svg.line().interpolate("cardinal").x(function(t){return r(t.year)}).y(function(t){return e(t.number)}),i=t.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),l=s.selectAll(".lines").data(i,function(t){return t.name}).enter().append("g").attr("class","lines");l.append("path").attr("class",function(t){return t.name+" graph1 chartline"}).attr("d",function(t){return n(t.values)}).attr("opacity",0),l.append("text").attr("class","pointlabel graph1").attr("text-anchor","end").attr("x",r(2014)).attr("y",function(t){return"standing"==t.name?e(t.values[t.values.length-1].number)-15:e(t.values[t.values.length-1].number)+15}).text(function(t,e){return a[e]}).attr("opacity",0),dispatch.on("intoGrowthLines",function(){if("total"!=GROWTHTYPE){d3.selectAll(".lines0").attr("opacity",0);var t=d3.max(data,function(t){return t.standing});dispatch.rescaleYAxis1(t)}d3.selectAll(" .graph2, .graph4, .circle, .mandminlabel, .graph0:not(standing)").transition().duration(0).attr("opacity",0),d3.selectAll(".graph1, .axis1, .linesaxis, .axisyears").transition().duration(500).attr("opacity",1)}),dispatch.on("changeGrowthLines",function(a){data=data_main.sentences.filter(function(t){return t.offense==a});var r="total"==a?22e4:d3.max(data,function(t){return t.standing});e=d3.scale.linear().range([c,0]).domain([0,r]),dispatch.rescaleYAxis1(r),i=t.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),l.selectAll("path").data(i,function(t){return t.name}).transition().duration(500).attr("d",function(t){return n(t.values)}),l.selectAll("text").data(i,function(t){return t.name}).transition().duration(500).attr("y",function(t){return"standing"==t.name?e(t.values[t.values.length-1].number)-15:e(t.values[t.values.length-1].number)+15})})}function e(){data=data_main.sentences;var t=["other","drug","weapon","immigration","sex"],a=d3.scale.linear().domain([0,22e4]).range([c,0],.1),e=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,o]),r=d3.nest().key(function(t){return t.offense}).sortKeys(function(a,e){return t.indexOf(a)-t.indexOf(e)}),n=d3.layout.stack().offset("zero").values(function(t){return t.values}).x(function(t){return t.year}).y(function(t){return t.standing}),i=n(r.entries(data.filter(function(t){return"total"!=t.offense}))),l=d3.svg.area().interpolate("cardinal").x(function(t){return e(t.year)}).y0(function(t){return a(t.y0)}).y1(function(t){return a(t.y0+t.y)}),d=d3.svg.line().interpolate("cardinal").x(function(t){return e(t.year)}).y(function(t){return a(t.y+t.y0)}),u=s.selectAll(".segment").data(i).enter().append("g").attr("class","segment");u.append("path").attr("class",function(t){return t.key+" layer graph2"}).attr("d",function(t){return l(t.values)}).attr("opacity",0),u.append("path").attr("class",function(t){return t.key+" chartline graph2"}).attr("d",function(t){return d(t.values)}).attr("opacity",0),u.append("text").datum(function(t){return{name:t.key,value:t.values[t.values.length-1]}}).attr("class",function(t){return t.name+" pointlabel graph2"}).attr("text-anchor","end").attr("x",function(t){return e(t.value.year)-10}).attr("y",function(t){return a(t.value.y0+.5*t.value.y)}).text(function(t){return t.name.capitalize()}).attr("opacity",0)}function r(){var t=d3.range(100).map(function(t){return{d:+t,ydig:+t.toString().slice(-1),xdig:+d3.format("02d")(t).slice(0,1),group:t<59?"applied":t>=59&t<78?"notapplied":"notapplicable"}}),a=s.append("g").attr("class","cells").selectAll("g").data(t).enter().append("g").attr("class","cell");a.append("rect").attr("class",function(t){return t.group+" circle"}).attr("x",function(t){return t.xdig*(o/10)}).attr("width",20).attr("height",20).attr("y",function(t){return t.ydig*(c/10)-20}).attr("rx",2*circleradius).attr("ry",2*circleradius).attr("opacity",0),s.append("text").attr("class","catvalue mandminlabel applied").attr("text-anchor","start").attr("x",0).attr("y",c+4).text("59%").attr("opacity",0),s.append("text").attr("class","graphtitle mandminlabel").attr("text-anchor","start").attr("x",0).attr("y",c+10).text(MANDMINLABELS[0]).call(wrap2,.4*o,0).attr("opacity",0),s.append("text").attr("class","catvalue mandminlabel notapplied").attr("text-anchor","start").attr("x",.6*o).attr("y",c+4).text("19%").attr("opacity",0),s.append("text").attr("class","graphtitle mandminlabel").attr("text-anchor","start").attr("x",.6*o).attr("y",c+10).text(MANDMINLABELS[1]).call(wrap2,.18*o,.6*o).attr("opacity",0),s.append("text").attr("class","catvalue mandminlabel notapplicable").attr("text-anchor","start").attr("x",.8*o).attr("y",c+4).text("22%").attr("opacity",0),s.append("text").attr("class","graphtitle mandminlabel").attr("text-anchor","start").attr("x",.8*o).attr("y",c+10).text(MANDMINLABELS[2]).call(wrap2,.18*o,.8*o).attr("opacity",0)}function n(){data=data_main.mandmin_drug;var t=d3.scale.linear().range([0,o]).domain([0,1]),a=d3.scale.linear().range([c-20,0]).domain([0,d3.max(data,function(t){return t.years})]),e=d3.svg.axis().scale(t).ticks(0).outerTickSize(0).orient("bottom");s.append("text").attr("class","axistitle graph4").attr("text-anchor","start").attr("x",0).attr("y",-30).text("Average expected years served").attr("opacity",0);var r=s.selectAll(".rect").data(data).enter().append("g").attr("class","rect");s.append("g").attr("class","x axis-show graph4").attr("transform","translate(0,"+(c-20)+")").call(e);r.append("rect").attr("class",function(t){return t.mm_status+" graph4"}).attr("x",function(a){return t(a.share_cum-a.share)}).attr("width",function(a){return t(a.share)}).attr("height",function(t){return a(0)-a(t.years)}).attr("y",function(t){return a(t.years)}).attr("opacity",0),r.append("text").attr("class","pointlabel graph4").attr("x",function(a){return t(a.share_cum-.5*a.share)}).attr("y",function(t){return a(t.years)-10}).text(function(t){return d3.format(".1f")(t.years)+" years"}).attr("text-anchor","middle").attr("opacity",0)}var i={top:60,right:15,bottom:95,left:70},o=$graphic1.width()-i.left-i.right,c=Math.min(450,windowHeight-100-i.top-i.bottom);$graphic1.empty();var s=d3.select("#graphic1").append("svg").attr("width",o+i.left+i.right).attr("height",c+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),l=d3.scale.linear().range([c,0]).domain([0,22e4]);s.append("text").attr("class","axistitle linesaxis").attr("text-anchor","middle").attr("x",0).attr("y",-15).text("Federal prison population");var d=d3.svg.axis().scale(l).tickSize(-o).ticks(5).orient("left"),u=s.append("g").attr("class","y axis linesaxis").call(d);u.selectAll("text").attr("dx",-8),u.selectAll("g").filter(function(t){return t}).classed("minor",!0);var p=d3.scale.linear().range([0,o]).domain([1980,2016]),f=d3.svg.axis().scale(p).ticks(8).tickFormat(function(t){return t}).orient("bottom");s.append("g").attr("class","x axis-show axisyears").attr("transform","translate(0,"+c+")").call(f);dispatch.on("rescaleXAxis",function(t,a){p.domain([t,a]),d3.select(".axisyears").transition().duration(1e3).ease("cubic-in-out").call(f)}),dispatch.on("rescaleYAxis1",function(t){l.domain([0,t]),d=d3.svg.axis().scale(l).tickSize(-o).ticks(5).tickFormat(function(t){return d3.format(",")(t)}).orient("left"),d3.selectAll(".axis.linesaxis").attr("opacity",1).transition().duration(1e3).ease("cubic-in-out").call(d).each("interrupt",function(){console.log("yikes fedpop axis 1"),d3.select(this).transition().duration(500).call(d)}),u.selectAll("text").attr("dx",-8),u.selectAll("g").filter(function(t){return t}).classed("minor",!0)}),t(),a(),e(),r(),n();graphScroll().container(d3.select("#container1")).graph(d3.selectAll("#graphic1")).sections(d3.selectAll("#section1 > div")).on("active",function(t){0==t?(d3.selectAll(".graph2, .graph1, .axis1, .graph4, .circle, .mandminlabel").transition().duration(0).attr("opacity",0),d3.selectAll(".graph0, .axisyears, .linesaxis, .lines0").transition().duration(500).attr("opacity",1),d3.selectAll(".axisyears").attr("opacity",1),dispatch.rescaleXAxis(1980,2016),22e4!=l.domain()[1]&&dispatch.rescaleYAxis1(22e4)):1==t?(1994!=p.domain()[0]&&dispatch.rescaleXAxis(1994,2014),dispatch.intoGrowthLines()):2==t?(d3.selectAll(".graph0, .graph1, .graph3, .graph4, .circle, .mandminlabel").transition().duration(0).attr("opacity",0),d3.selectAll(".graph2, .linesaxis, .axis1, .axisyears").transition().duration(500).attr("opacity",1),22e4!=l.domain()[1]&&dispatch.rescaleYAxis1(22e4)):3==t?(d3.selectAll(".graph0, .graph1, .graph2, .axis1, .axisyears, .linesaxis, .graph4").transition().duration(0).attr("opacity",0),d3.selectAll(".graph3, .mandminlabel").transition().duration(500).attr("opacity",1),d3.selectAll(".circle").transition().duration(500).attr("opacity",1).transition().duration(1e3).attr("rx",2*circleradius).attr("ry",2*circleradius).attr("width",20).attr("height",20)):4==t&&(d3.selectAll(".graph0, .graph1, .graph2, .axis1, .axisyears, .linesaxis, .graph3").transition().duration(0).attr("opacity",0),d3.selectAll(".circle").transition().duration(1e3).attr("rx",0).attr("ry",0).attr("width",o/10).attr("height",c/10).transition().duration(500).attr("opacity",0),d3.selectAll(".graph4, .mandminlabel").transition().delay(1e3).duration(500).attr("opacity",1))})}function graph2(){function t(){var t=d3.geo.albersUsa().scale(1.4*i).translate([i/2,o/2]),a=d3.scale.linear().domain(BREAKS).range(blue5),e=d3.geo.path().projection(t),r=data_main.districtsentences,n=data_main.complexzips,s=data_main.zipsbydistrict;r=r.filter(function(t){return"VI"!=t.districtcode&"GU"!=t.districtcode&"PR"!=t.districtcode}),n=n.filter(function(t){return"00965"!=t.zip}),s=s.filter(function(t){return"VI"!=t.districtcode&"GU"!=t.districtcode&"PR"!=t.districtcode&"00965"!=t.zip&""!=t.zip}),s.forEach(function(a){a.sentences=+a.sentences;t(a);a.complex=t([+a.zip_long,+a.zip_lat]),a.district=t([+a.centroid_long,+a.centroid_lat])});var l=d3.nest().key(function(t){return t.districtcode}).sortKeys(d3.ascending).entries(s);r.forEach(function(a){a.sentences=+a.sentences,a[0]=+a.longitude,a[1]=+a.latitude;var e=t(a);a.centroidx=e[0],a.centroidy=e[1],a.lines=l.filter(function(t){return t.key==a.districtcode})[0]}),n.forEach(function(a){a.sentences=+a.sentences,a[0]=+a.longitude,a[1]=+a.latitude;var e=t(a);a.complexx=e[0],a.complexy=e[1]}),c.append("g").attr("class","districts graphmap").selectAll("path").data(topojson.feature(districts,districts.objects.JudicialDistricts_Final).features).enter().append("path").attr("d",e).attr("class","district").attr("code",function(t){return t.properties.code}).attr("fill",function(t){return a(t.properties.sentences)}).on("mouseover",function(t){"AK"!=t.properties.code?(d3.selectAll(".hovered").classed("hovered",!1),d3.selectAll("."+d3.select(this).attr("code")).classed("hovered",!0),d3.select(this).classed("hovered",!0)):(d3.select(this).attr("fill","#fdbf11"),d3.selectAll(".AK").classed("hovered",!0))}).on("mouseout",function(t){d3.select(this).attr("fill",function(t){return a(t.properties.sentences)}),d3.selectAll(".hovered").classed("hovered",!1)});var d=c.append("g").attr("class","complexes graphmap").selectAll("g").data(n.sort(function(t,a){return a.sentences-t.sentences})).enter().append("g").attr("class","complex");d.append("circle").attr("cx",function(t){return t.complexx}).attr("cy",function(t){return t.complexy}).attr("r",function(t,a){return Math.sqrt(t.sentences)/10}).attr("class",function(t){return"zip_"+t.zip});var u=c.append("g").attr("class","centroids graphmap").selectAll("g").data(r).enter().append("g").attr("class",function(t){return t.districtcode+" centroid"}).attr("temp",function(t){return t.lines.key});if(u.append("g").attr("class",function(t){return t.districtcode+" sentence-arcs graphmap"}).selectAll("path").data(function(t){return t.lines.values}).enter().append("line").attr("zip",function(t){return d3.select("circle.zip_"+t.zip).classed(t.districtcode,!0),t.zip}).attr("x1",function(t){return t.district[0]}).attr("y1",function(t){return t.district[1]}).attr("x2",function(t){return t.complex[0]}).attr("y2",function(t){return t.complex[1]}),d3.selectAll(".KS, [code='KS']").classed("hovered",!0),i<450)var p=6,f=(i-12)/5;else var p=i/2,f=40;var h=20,m=c.selectAll("g.legend").data(LEGENDBREAKS).enter().append("g").attr("class","legend");m.append("text").data(LEGENDBREAKS).attr("class","pointlabel graphmap").attr("x",function(t,a){return a*f+p-2}).attr("y",50).attr("text-anchor","middle").text(function(t){return d3.format(",")(t)}),m.append("rect").data(blue5).attr("class","graphmap").attr("x",function(t,a){return a*f+p}).attr("y",15).attr("width",f).attr("height",h).style("fill",function(t,a){return blue5[a]}),c.append("text").attr("class","axistitle graphmap").attr("text-anchor","start").attr("x",p).attr("y",10).text("Number of people sentenced"),c.append("text").attr("class","footnote graphmap").attr("text-anchor","start").attr("x",0).attr("y",o).text(MAPNOTE).call(wrap2,i+40,-40)}function a(){data=data_main.race;var t=d3.scale.linear().domain([0,22e4]).range([o,0],.1),a=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,i]),e=d3.svg.axis().scale(a).orient("bottom").tickFormat(function(t){return t}).ticks(10),r=d3.nest().key(function(t){return t.race}).sortKeys(function(t,a){return RACEORDER.indexOf(t)-RACEORDER.indexOf(a)}),n=d3.layout.stack().offset("zero").values(function(t){return t.values}).x(function(t){return t.year}).y(function(t){return t.pop_total}),s=n(r.entries(data)),l=d3.svg.area().interpolate("cardinal").x(function(t){return a(t.year)}).y0(function(a){return t(a.y0)}).y1(function(a){return t(a.y0+a.y)}),d=d3.svg.line().interpolate("cardinal").x(function(t){return a(t.year)}).y(function(a){return t(a.y+a.y0)}),u=c.selectAll(".racegroup").data(s).enter().append("g").attr("class","racegroup");u.append("path").attr("class",function(t){return t.key+" layer graphrace"}).attr("d",function(t){return l(t.values)}).attr("opacity",0),u.append("path").attr("class",function(t){return t.key+" chartline graphrace"}).attr("d",function(t){return d(t.values)}).attr("opacity",0),u.append("text").datum(function(t){return{name:t.key,value:t.values[t.values.length-1]}}).attr("class",function(t){return t.name+" pointlabel graphrace"}).attr("text-anchor","end").attr("x",function(t){return a(t.value.year)-10}).attr("y",function(a){return t(a.value.y0+.5*a.value.y)+2}).text(function(t){return t.name.capitalize()}).attr("opacity",0);c.append("g").attr("class","x axis-show graphrace").attr("transform","translate(0,"+o+")").call(e)}function e(){data=data_main.histories.filter(function(t){return"drug"==t.offense});var t=d3.scale.linear().range([o,0]).domain([0,d3.max(data,function(t){return t.number})]),a=d3.scale.ordinal().rangeRoundBands([0,i],.1).domain(data.map(function(t){return t.category})),e=d3.svg.axis().scale(a).tickSize(0).tickFormat(function(t,a){return t}).orient("bottom"),r=c.selectAll(".chbar").data(data,function(t){return t.category}).enter().append("g").attr("class","chbar");r.append("rect").attr("class","graphch bar").attr("x",function(t){return a(t.category)}).attr("width",a.rangeBand()).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).attr("opacity",0);c.append("g").attr("transform","translate(0,"+o+")").attr("class","x axis-show graphch").call(e);c.append("text").attr("class","axistitle graphch").attr("text-anchor","middle").attr("x",i/2).attr("y",o+30).text("Criminal history category").attr("opacity",0),c.append("text").attr("class","axis graphch").attr("text-anchor","middle").attr("x",0).attr("y",o+10).text("No or minimal criminal history").call(wrap2,a.rangeBand(),a.rangeBand()/2).attr("opacity",0),c.append("text").attr("class","axis graphch").attr("text-anchor","middle").attr("x",i).attr("y",o+10).text("Most criminal history").call(wrap2,a.rangeBand(),i-a.rangeBand()/2).attr("opacity",0),dispatch.on("changeChBars",function(a){data=data_main.histories.filter(function(t){return t.offense==a}),t=d3.scale.linear().range([o,0]).domain([0,d3.max(data,function(t){return t.number})]),r.selectAll("rect").data(data,function(t){return t.category}).transition().duration(500).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).each("interrupt",function(){d3.select(this).data(data,function(t){return t.category}).transition().attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)})}),dispatch.rescaleYAxis(d3.max(data,function(t){return t.number}))}),dispatch.on("intoChBars",function(){var e=d3.select('label[name="radio-ch"].active').attr("value"),r=d3.max(data_main.histories.filter(function(t){return t.offense==e}),function(t){return t.number}),n=d3.selectAll("rect.graphch").attr("height");n==o/2?(d3.selectAll(".graphmap, .graphrace").transition().duration(0).attr("opacity",0),d3.selectAll("rect.graphsecurity").transition().duration(500).attr("opacity",1).transition().duration(1e3).attr("width",i/4).attr("y",o/2).attr("height",o/2).transition().duration(500).attr("opacity",0).each("interrupt",function(){d3.select(this).transition().attr("opacity",0)}),d3.selectAll("rect.graphch").transition().delay(1e3).duration(500).attr("opacity",1).transition().duration(1e3).attr("width",a.rangeBand()).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).each("interrupt",function(){d3.select(this).transition().attr("width",a.rangeBand()).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).attr("opacity",1)}),dispatch.rescaleYAxis(r),d3.selectAll(".axistitle.graphsecurity, .axis-show.graphsecurity, .pointlabel.graphsecurity, .axis.graphsecurity").transition().delay(500).duration(500).attr("opacity",0),d3.selectAll(".axistitle.graphch, .axis-show.graphch, .pointlabel.graphch, .axis.graphch").transition().delay(2e3).duration(500).attr("opacity",1)):(d3.selectAll(".graphmap, .graphrace, .graphsecurity").transition().duration(0).attr("opacity",0),d3.selectAll(".graphch, .fedpop").transition().duration(500).attr("opacity",1),dispatch.rescaleYAxis(r))})}function r(){data=data_main.security.filter(function(t){return"drug"==t.offense}),VALUE="number";var t=d3.scale.linear().range([o,0]).domain([0,d3.max(data,function(t){return t[VALUE]})]),a=d3.scale.ordinal().rangeRoundBands([0,i],.1).domain(data.map(function(t){return t.security})),e=d3.svg.axis().scale(a).tickSize(0).tickFormat(function(t,a){return t}).orient("bottom"),r=c.selectAll(".securitybar").data(data,function(t){return t.security}).enter().append("g").attr("class","securitybar");r.append("rect").attr("class","graphsecurity bar").attr("x",function(t){return a(t.security)}).attr("width",i/5).attr("y",o/2).attr("height",o/2).attr("opacity",0);c.append("g").attr("transform","translate(0,"+o+")").attr("class","x axis-show graphsecurity").call(e);c.append("text").attr("class","axistitle graphsecurity").attr("text-anchor","middle").attr("x",i/2).attr("y",o+30).text("Security type").attr("opacity",0),dispatch.on("changeSecurityBars",function(a){data=data_main.security.filter(function(t){return t.offense==a}),t=d3.scale.linear().range([o,0]).domain([0,d3.max(data,function(t){return t.number})]),r.selectAll("rect").data(data,function(t){return t.security}).transition().duration(500).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}),dispatch.rescaleYAxis(d3.max(data,function(t){return t.number}))}),dispatch.on("intoSecurityBars",function(){var e=d3.select('label[name="radio-security"].active').attr("value"),r=d3.max(data_main.security.filter(function(t){return t.offense==e}),function(t){return t.number});d3.selectAll(".graphmap, .graphrace").transition().duration(0).attr("opacity",0),d3.selectAll("rect.graphch").transition().duration(500).attr("opacity",1).transition().duration(1e3).attr("width",i/6).attr("y",o/2).attr("height",o/2).transition().duration(500).attr("opacity",0).each("interrupt",function(){d3.select(this).transition().attr("opacity",0)}),d3.selectAll("rect.graphsecurity").transition().delay(1e3).duration(500).attr("opacity",1).transition().duration(1e3).attr("width",a.rangeBand()).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).each("interrupt",function(){d3.select(this).transition().duration(0).attr("width",a.rangeBand()).attr("y",function(a){return t(a.number)}).attr("height",function(a){return o-t(a.number)}).attr("opacity",1)}),dispatch.rescaleYAxis(r),d3.selectAll(".axistitle.graphch, .axis-show.graphch, .pointlabel.graphch, .axis.graphch").transition().delay(500).duration(500).attr("opacity",0),d3.selectAll(".axistitle.graphsecurity, .axis-show.graphsecurity, .pointlabel.graphsecurity, .axis.graphsecurity").transition().delay(2e3).duration(500).attr("opacity",1)})}var n={top:60,right:15,bottom:75,left:70},i=$graphic1.width()-n.left-n.right,o=Math.min(450,windowHeight-100-n.top-n.bottom);$graphic2.empty();var c=d3.select("#graphic2").append("svg").attr("width",i+n.left+n.right).attr("height",o+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),s=d3.scale.linear().range([o,0]).domain([0,22e4]);c.append("text").attr("class","axistitle fedpop").attr("text-anchor","middle").attr("x",0).attr("y",-15).text("Federal prison population").attr("opacity",0);var l=d3.svg.axis().scale(s).tickSize(-i).ticks(5).orient("left"),d=c.append("g").attr("class","y axis fedpop").call(l);d.selectAll("text").attr("dx",-8),d.selectAll("g").filter(function(t){return t}).classed("minor",!0),dispatch.on("rescaleYAxis",function(t){s.domain([0,t]),l=d3.svg.axis().scale(s).tickSize(-i).ticks(5).tickFormat(function(t){return d3.format(",")(t)}).orient("left"),d3.selectAll(".axis.fedpop").transition().duration(1e3).ease("cubic-in-out").call(l).each("interrupt",function(){d3.select(this).transition().duration(500).call(l)}),d.selectAll("text").attr("dx",-8),d.selectAll("g").filter(function(t){return t}).classed("minor",!0)}),t(),a(),e(),r();graphScroll().container(d3.select("#container2")).graph(d3.selectAll("#graphic2")).sections(d3.selectAll("#section2 > div")).on("active",function(t){0==t?(d3.selectAll(".graphrace, .graphch, .graphsecurity, .fedpop").transition().duration(0).attr("opacity",0),d3.selectAll(".graphmap").transition().duration(0).attr("opacity",1)):1==t?(d3.selectAll(".graphmap, .graphch, .graphsecurity").transition().duration(0).attr("opacity",0),d3.selectAll(".graphrace, .fedpop").transition().duration(500).attr("opacity",1),22e4!=s.domain()[1]&&dispatch.rescaleYAxis(22e4)):2==t?dispatch.intoChBars():3==t&&dispatch.intoSecurityBars()})}function graph3(){var t={top:60,right:15,bottom:75,left:70},a=$graphic1.width()-t.left-t.right,e=Math.min(450,windowHeight-100-t.top-t.bottom);$graphic3.empty();var r=d3.select("#graphic3").append("svg").attr("width",a+t.left+t.right).attr("height",e+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");data=data_main.jointimpact;var n=["pop_baseline","pop_jointimpact"],i=["No policy changes","All recommended reforms"],o=d3.scale.linear().domain([0,22e4]).range([e,0],.1),c=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,a]),s=d3.svg.axis().scale(c).orient("bottom").tickFormat(function(t){return t}).ticks(5),l=d3.svg.axis().scale(o).tickSize(-a).ticks(5).orient("left"),d=r.append("g").attr("class","y axis").call(l);d.selectAll("text").attr("dx",-8),d.selectAll("g").filter(function(t){return t}).classed("minor",!0),r.append("text").attr("class","axistitle").attr("text-anchor","middle").attr("x",0).attr("y",-15).text("Federal prison population");var u=(r.append("g").attr("class","x axis-show").attr("transform","translate(0,"+e+")").call(s),d3.svg.line().interpolate("cardinal").x(function(t){return c(t.year)}).y(function(t){return o(t.number)})),p=n.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),f=r.selectAll(".chartline").data(p).enter().append("g").attr("class","chartline");f.append("path").attr("class",function(t){return t.name}).attr("d",function(t){return u(t.values)}),f.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-1]}}).attr("class","pointlabel").attr("text-anchor","end").attr("x",function(t){return c(t.value.year)}).attr("y",function(t){return"pop_baseline"==t.name?o(t.value.number)-15:o(t.value.number)+15}).text(function(t,a){return i[a]});graphScroll().container(d3.select("#container3")).graph(d3.selectAll("#graphic3")).sections(d3.selectAll("#section3 > div")).on("active",function(t){})}function formatYear(t){return"'"+t.toString().slice(-2)}function mobileGrowth(t){var a=$(t),e={top:30,right:15,bottom:35,left:60},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.scale.linear().range([n,0]).domain([0,22e4]);i.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",-e.left).attr("y",-5).text("Federal prison population");var c=d3.svg.axis().scale(o).tickSize(-r).ticks(5).orient("left"),s=i.append("g").attr("class","y axis").call(c);s.selectAll("text").attr("dx",-8),s.selectAll("g").filter(function(t){return t}).classed("minor",!0);var l=d3.scale.linear().range([0,r]).domain([1980,2016]),d=d3.svg.axis().scale(l).ticks(6).tickFormat(function(t){return formatYear(t)}).orient("bottom"),u=(i.append("g").attr("class","x axis-show").attr("transform","translate(0,"+n+")").call(d),["standing","pop_total"]),p=["Federally sentenced population","Total federal prison population"];data=data_main.growth;var f=d3.svg.line().interpolate("cardinal").defined(function(t){return null!=t.number&t.number>0}).x(function(t){return l(t.year)}).y(function(t){return o(t.number)}),h=u.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),m=i.selectAll(".lines").data(h).enter().append("g").attr("class","lines0");m.append("path").attr("class",function(t){return t.name+" chartline"}).attr("d",function(t){return f(t.values)}).attr("opacity",1),m.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-3]}}).attr("class","pointlabel").attr("text-anchor","end").attr("x",l(2016)).attr("y",function(t){return"pop_total"==t.name?o(t.value.number)-40:o(12e4)+15}).text(function(t,a){return p[a]}).attr("opacity",1).call(wrap2,.5*r,r)}function mobileDrivers(t){var a=$(t),e={top:40,right:15,bottom:35,left:60},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.scale.linear().range([n,0]).domain([0,22e4]);i.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",-e.left).attr("y",-25).text("Federal prison population");var c=d3.svg.axis().scale(o).tickSize(-r).ticks(5).orient("left"),s=i.append("g").attr("class","y axis mobilelinesaxis").call(c);s.selectAll("text").attr("dx",-8),s.selectAll("g").filter(function(t){return t}).classed("minor",!0),data=data_main.sentences.filter(function(t){return"total"==t.offense});var l=["standing","admissions"],d=["Federally sentenced population","Admissions"],u=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,r]),p=d3.svg.axis().scale(u).orient("bottom").tickFormat(function(t){return formatYear(t)}).tickValues(mainyears),f=(i.append("g").attr("class","x axis-show").attr("transform","translate(0,"+n+")").call(p),d3.svg.line().interpolate("cardinal").x(function(t){return u(t.year)}).y(function(t){return o(t.number)})),h=l.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),m=i.selectAll(".lines").data(h,function(t){return t.name}).enter().append("g").attr("class","lines");m.append("path").attr("class",function(t){return t.name+" chartline"}).attr("d",function(t){return f(t.values)}),m.append("text").attr("class","pointlabel").attr("text-anchor","end").attr("x",u(2014)).attr("y",function(t){return"standing"==t.name?o(t.values[t.values.length-1].number)-15:o(t.values[t.values.length-1].number)+15}).text(function(t,a){return d[a]}),dispatch.on("changeGrowthLines",function(t){data=data_main.sentences.filter(function(a){return a.offense==t});var a="total"==t?22e4:d3.max(data,function(t){return t.standing});o=d3.scale.linear().range([n,0]).domain([0,a]),c=d3.svg.axis().scale(o).tickSize(-r).ticks(5).tickFormat(function(t){return d3.format(",")(t)}).orient("left"),d3.selectAll(".mobilelinesaxis").transition().duration(1e3).ease("cubic-in-out").call(c).each("interrupt",function(){console.log("yikes fedpop axis")}),s.selectAll("text").attr("dx",-8),s.selectAll("g").filter(function(t){return t}).classed("minor",!0),h=l.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),m.selectAll("path").data(h,function(t){return t.name}).transition().duration(500).attr("d",function(t){return f(t.values)}),m.selectAll("text").data(h,function(t){return t.name}).transition().duration(500).attr("y",function(t){
return"standing"==t.name?o(t.values[t.values.length-1].number)-15:o(t.values[t.values.length-1].number)+15})})}function mobileOffense(t){var a=$(t);data=data_main.sentences;var e=["other","drug","weapon","immigration","sex"],r={top:20,right:15,bottom:35,left:60},n=a.width()-r.left-r.right,i=Math.max(275-r.top-r.bottom,Math.min(Math.ceil(1.1*n)-r.top-r.bottom,windowHeight-100-r.top-r.bottom));a.empty();var o=d3.select(t).append("svg").attr("width",n+r.left+r.right).attr("height",i+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),c=d3.scale.linear().domain([0,22e4]).range([i,0],.1),s=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,n]),l=d3.svg.axis().scale(s).orient("bottom").tickFormat(function(t){return formatYear(t)}).tickValues(mainyears),d=(o.append("g").attr("class","x axis-show").attr("transform","translate(0,"+i+")").call(l),d3.svg.axis().scale(c).tickSize(-n).ticks(5).orient("left")),u=o.append("g").attr("class","y axis").call(d);u.selectAll("text").attr("dx",-8),u.selectAll("g").filter(function(t){return t}).classed("minor",!0),o.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",-r.left).attr("y",-5).text("Federal prison population");var p=d3.nest().key(function(t){return t.offense}).sortKeys(function(t,a){return e.indexOf(t)-e.indexOf(a)}),f=d3.layout.stack().offset("zero").values(function(t){return t.values}).x(function(t){return t.year}).y(function(t){return t.standing}),h=f(p.entries(data.filter(function(t){return"total"!=t.offense}))),m=d3.svg.area().interpolate("cardinal").x(function(t){return s(t.year)}).y0(function(t){return c(t.y0)}).y1(function(t){return c(t.y0+t.y)}),g=d3.svg.line().interpolate("cardinal").x(function(t){return s(t.year)}).y(function(t){return c(t.y+t.y0)}),x=o.selectAll(".segment").data(h).enter().append("g").attr("class","segment");x.append("path").attr("class",function(t){return t.key+" layer"}).attr("d",function(t){return m(t.values)}),x.append("path").attr("class",function(t){return t.key+" chartline"}).attr("d",function(t){return g(t.values)});var y=o.selectAll(".offenselabel").data(h).enter().append("g").attr("class","offenselabel");y.append("text").datum(function(t){return{name:t.key,value:t.values[t.values.length-1]}}).attr("class",function(t){return t.name+" pointlabel"}).attr("text-anchor","end").attr("x",function(t){return s(t.value.year)-10}).attr("y",function(t){return c(t.value.y0+.5*t.value.y)}).text(function(t){return t.name.capitalize()})}function mobileMm(t){circleradius=7;var a=$(t),e={top:20,right:8,bottom:80,left:8},r=a.width()-e.left-e.right,n=Math.max(300-e.top-e.bottom,Math.min(Math.ceil(1.3*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.range(100).map(function(t){return{d:+t,ydig:+t.toString().slice(-1),xdig:+d3.format("02d")(t).slice(0,1),group:t<59?"applied":t>=59&t<78?"notapplied":"notapplicable"}}),c=i.append("g").attr("class","circlecells").selectAll("g").data(o).enter().append("g").attr("class","circlecell");c.append("rect").attr("class",function(t){return t.group}).attr("x",function(t){return t.xdig*(r/10)}).attr("width",2*circleradius).attr("height",2*circleradius).attr("y",function(t){return t.ydig*(n/10)-20}).attr("rx",2*circleradius).attr("ry",2*circleradius).attr("opacity",1),i.append("text").attr("class","catvalue mandminlabel applied").attr("text-anchor","start").attr("x",0).attr("y",n+4).text("59%").attr("opacity",1),i.append("text").attr("class","axis mandminlabel").attr("text-anchor","start").attr("x",0).attr("y",n+10).attr("opacity",1).text(MANDMINLABELS[0]).call(wrap2,.4*r,0),i.append("text").attr("class","catvalue mandminlabel notapplied").attr("text-anchor","start").attr("x",.5*r).attr("y",n+4).text("19%").attr("opacity",1),i.append("text").attr("class","axis mandminlabel").attr("text-anchor","start").attr("x",.6*r).attr("y",n+10).attr("opacity",1).text(MANDMINLABELS[1]).call(wrap2,.2*r,.5*r),i.append("text").attr("class","catvalue mandminlabel notapplicable").attr("text-anchor","start").attr("x",.75*r).attr("y",n+4).text("22%").attr("opacity",1),i.append("text").attr("class","axis mandminlabel").attr("text-anchor","start").attr("x",.8*r).attr("y",n+10).attr("opacity",1).text(MANDMINLABELS[2]).call(wrap2,.22*r,.75*r)}function mobileYears(t){var a=$(t),e={top:20,right:15,bottom:70,left:15},r=a.width()-e.left-e.right,n=Math.max(300-e.top-e.bottom,Math.min(Math.ceil(1.3*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");data=data_main.mandmin_drug;var o=d3.scale.ordinal().rangeRoundBands([0,r],.1).domain(data.map(function(t){return t.mm_status})),c=d3.scale.linear().range([n-20,0]).domain([0,d3.max(data,function(t){return t.years})]),s=d3.svg.axis().scale(o).tickSize(0).tickFormat(function(t,a){return MANDMINLABELS[a]}).orient("bottom");i.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",0).attr("y",-30).text("Average expected years served");var l=i.selectAll(".rect").data(data).enter().append("g").attr("class","rect");l.append("rect").attr("class",function(t){return t.mm_status}).attr("x",function(t){return o(t.mm_status)}).attr("width",o.rangeBand()).attr("y",function(t){return c(t.years)}).attr("height",function(t){return n-c(t.years)}),l.append("text").attr("class","pointlabel").attr("y",function(t){return c(t.years)-8}).attr("x",function(t){return o(t.mm_status)+o.rangeBand()/2}).attr("text-anchor","middle").text(function(t){return d3.format(".1f")(t.years)+" years"});i.append("g").attr("transform","translate(0,"+n+")").attr("class","x axis-show").call(s).selectAll(".tick text").call(wrap,o.rangeBand())}function mobileMap(t){var a=$(t),e=$("#mobilelegend"),r={top:15,right:20,bottom:15,left:20},n=a.width()-r.left-r.right,i=Math.ceil(.75*n)-r.top-r.bottom;a.empty(),e.empty();var o=d3.select(t).append("svg").attr("width",n+r.left+r.right).attr("height",i+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),c=d3.geo.albersUsa().scale(1.4*n).translate([n/2,i/2]),s=d3.scale.linear().domain(BREAKS).range(blue5),l=d3.geo.path().projection(c),d=data_main.districtsentences,u=data_main.complexzips,p=data_main.zipsbydistrict;d=d.filter(function(t){return"VI"!=t.districtcode&"GU"!=t.districtcode&"PR"!=t.districtcode}),u=u.filter(function(t){return"00965"!=t.zip}),p=p.filter(function(t){return"VI"!=t.districtcode&"GU"!=t.districtcode&"PR"!=t.districtcode&"00965"!=t.zip&""!=t.zip}),p.forEach(function(t){t.sentences=+t.sentences;c(t);t.complex=c([+t.zip_long,+t.zip_lat]),t.district=c([+t.centroid_long,+t.centroid_lat])});var f=d3.nest().key(function(t){return t.districtcode}).sortKeys(d3.ascending).entries(p);d.forEach(function(t){t.sentences=+t.sentences,t[0]=+t.longitude,t[1]=+t.latitude;var a=c(t);t.centroidx=a[0],t.centroidy=a[1],t.lines=f.filter(function(a){return a.key==t.districtcode})[0]}),u.forEach(function(t){t.sentences=+t.sentences,t[0]=+t.longitude,t[1]=+t.latitude;var a=c(t);t.complexx=a[0],t.complexy=a[1]}),o.append("g").attr("class","districts").selectAll("path").data(topojson.feature(districts,districts.objects.JudicialDistricts_Final).features).enter().append("path").attr("d",l).attr("class","district").attr("code",function(t){return t.properties.code}).attr("fill",function(t){return s(t.properties.sentences)}).on("mouseover",function(t){"AK"!=t.properties.code?(d3.selectAll(".hovered").classed("hovered",!1),d3.selectAll("."+d3.select(this).attr("code")).classed("hovered",!0),d3.select(this).classed("hovered",!0)):(d3.select(this).attr("fill","#fdbf11"),d3.selectAll(".AK").classed("hovered",!0))}).on("mouseout",function(t){d3.select(this).attr("fill",function(t){return s(t.properties.sentences)}),d3.selectAll(".hovered").classed("hovered",!1)});var h=o.append("g").attr("class","complexes").selectAll("g").data(u.sort(function(t,a){return a.sentences-t.sentences})).enter().append("g").attr("class","complex");h.append("circle").attr("cx",function(t){return t.complexx}).attr("cy",function(t){return t.complexy}).attr("r",function(t,a){return Math.sqrt(t.sentences)/10}).attr("class",function(t){return"zip_"+t.zip});var m=o.append("g").attr("class","centroids").selectAll("g").data(d).enter().append("g").attr("class",function(t){return t.districtcode+" centroid"}).attr("temp",function(t){return t.lines.key});m.append("g").attr("class",function(t){return t.districtcode+" sentence-arcs"}).selectAll("path").data(function(t){return t.lines.values}).enter().append("line").attr("zip",function(t){return d3.select("circle.zip_"+t.zip).classed(t.districtcode,!0),t.zip}).attr("x1",function(t){return t.district[0]}).attr("y1",function(t){return t.district[1]}).attr("x2",function(t){return t.complex[0]}).attr("y2",function(t){return t.complex[1]}),d3.selectAll(".KS, [code='KS']").classed("hovered",!0);var g=d3.select("#mobilelegend").append("svg").attr("width",n+r.left+r.right).attr("height",50+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),x=0,y=n/5,v=20,b=g.selectAll("g.legend").data(LEGENDBREAKS).enter().append("g").attr("class","legend");b.append("text").data(LEGENDBREAKS).attr("class","pointlabel").attr("x",function(t,a){return a*y+x-2}).attr("y",50).attr("text-anchor","middle").text(function(t){return d3.format(",")(t)}),b.append("rect").data(blue5).attr("x",function(t,a){return a*y+x}).attr("y",15).attr("width",y).attr("height",v).style("fill",function(t,a){return blue5[a]}),g.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",x).attr("y",10).text("Number of people sentenced")}function mobileRace(t){var a=$(t);data=data_main.race;var e={top:20,right:15,bottom:35,left:60},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.scale.linear().domain([0,22e4]).range([n,0],.1),c=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,r]),s=d3.svg.axis().scale(c).orient("bottom").tickFormat(function(t){return formatYear(t)}).tickValues(mainyears),l=d3.svg.axis().scale(o).tickSize(-r).ticks(5).orient("left"),d=i.append("g").attr("class","y axis").call(l);d.selectAll("text").attr("dx",-8),d.selectAll("g").filter(function(t){return t}).classed("minor",!0),i.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",-e.left).attr("y",-5).text("Federal prison population");var u=d3.nest().key(function(t){return t.race}).sortKeys(function(t,a){return RACEORDER.indexOf(t)-RACEORDER.indexOf(a)}),p=d3.layout.stack().offset("zero").values(function(t){return t.values}).x(function(t){return t.year}).y(function(t){return t.pop_total}),f=p(u.entries(data)),h=d3.svg.area().interpolate("cardinal").x(function(t){return c(t.year)}).y0(function(t){return o(t.y0)}).y1(function(t){return o(t.y0+t.y)}),m=d3.svg.line().interpolate("cardinal").x(function(t){return c(t.year)}).y(function(t){return o(t.y+t.y0)}),g=i.selectAll(".racegroup").data(f).enter().append("g").attr("class","racegroup");g.append("path").attr("class",function(t){return t.key+" layer"}).attr("d",function(t){return h(t.values)}),g.append("path").attr("class",function(t){return t.key+" chartline"}).attr("d",function(t){return m(t.values)});var x=i.selectAll(".racelabel").data(f).enter().append("g").attr("class","racelabel");x.append("text").datum(function(t){return{name:t.key,value:t.values[t.values.length-1]}}).attr("class",function(t){return t.name+" pointlabel"}).attr("text-anchor","end").attr("x",function(t){return c(t.value.year)-10}).attr("y",function(t){return o(t.value.y0+.5*t.value.y)+2}).text(function(t){return t.name.capitalize()});i.append("g").attr("class","x axis-show").attr("transform","translate(0,"+n+")").call(s)}function mobileCh(t){var a=$(t);data=data_main.histories.filter(function(t){return"drug"==t.offense});var e={top:30,right:15,bottom:65,left:15},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.scale.linear().range([n,0]).domain([0,d3.max(data,function(t){return t.number})]),c=d3.scale.ordinal().rangeRoundBands([0,r],.1).domain(data.map(function(t){return t.category})),s=d3.svg.axis().scale(c).tickSize(0).tickFormat(function(t,a){return t}).orient("bottom"),l=i.selectAll(".bar").data(data,function(t){return t.category}).enter().append("g").attr("class","bar");l.append("rect").attr("class","bar").attr("x",function(t){return c(t.category)}).attr("width",c.rangeBand()).attr("y",function(t){return o(t.number)}).attr("height",function(t){return n-o(t.number)}),l.append("text").attr("class","pointlabel").attr("y",function(t){return o(t.number)-8}).attr("x",function(t){return c(t.category)+c.rangeBand()/2}).attr("text-anchor","middle").text(function(t){return d3.format(",.0f")(t.number)});i.append("g").attr("transform","translate(0,"+n+")").attr("class","x axis-show").call(s);i.append("text").attr("class","axistitle").attr("text-anchor","middle").attr("x",r/2).attr("y",n+30).text("Criminal history category"),i.append("text").attr("class","axis").attr("text-anchor","middle").attr("x",0).attr("y",n+10).text("No or minimal criminal history").call(wrap2,c.rangeBand(),c.rangeBand()/2),i.append("text").attr("class","axis").attr("text-anchor","middle").attr("x",r).attr("y",n+10).text("Most criminal history").call(wrap2,c.rangeBand(),r-c.rangeBand()/2),dispatch.on("changeChBars",function(t){data=data_main.histories.filter(function(a){return a.offense==t}),o=d3.scale.linear().range([n,0]).domain([0,d3.max(data,function(t){return t.number})]),l.selectAll("rect").data(data,function(t){return t.category}).transition().duration(500).attr("y",function(t){return o(t.number)}).attr("height",function(t){return n-o(t.number)}),l.selectAll("text").data(data,function(t){return t.category}).transition().duration(500).attr("y",function(t){return o(t.number)-8}).text(function(t){return d3.format(",.0f")(t.number)})})}function mobileSecurity(t){var a=$(t);data=data_main.security.filter(function(t){return"drug"==t.offense});var e={top:30,right:15,bottom:25,left:15},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.scale.linear().range([n,0]).domain([0,d3.max(data,function(t){return t.number})]),c=d3.scale.ordinal().rangeRoundBands([0,r],.1).domain(data.map(function(t){return t.security})),s=d3.svg.axis().scale(c).tickSize(0).tickFormat(function(t,a){return t}).orient("bottom"),l=i.selectAll(".securitybar").data(data,function(t){return t.security}).enter().append("g").attr("class","securitybar");l.append("rect").attr("class","bar").attr("x",function(t){return c(t.security)}).attr("width",c.rangeBand()).attr("y",function(t){return o(t.number)}).attr("height",function(t){return n-o(t.number)}),l.append("text").attr("class","pointlabel").attr("y",function(t){return o(t.number)-8}).attr("x",function(t){return c(t.security)+c.rangeBand()/2}).attr("text-anchor","middle").text(function(t){return d3.format(",.0f")(t.number)});i.append("g").attr("transform","translate(0,"+n+")").attr("class","x axis-show").call(s);dispatch.on("changeSecurityBars",function(t){data=data_main.security.filter(function(a){return a.offense==t}),o=d3.scale.linear().range([n,0]).domain([0,d3.max(data,function(t){return t.number})]),l.selectAll("rect").data(data,function(t){return t.security}).transition().duration(500).attr("y",function(t){return o(t.number)}).attr("height",function(t){return n-o(t.number)}),l.selectAll("text").data(data,function(t){return t.security}).transition().duration(500).attr("y",function(t){return o(t.number)-8}).text(function(t){return d3.format(",.0f")(t.number)})})}function mobileConclusion(t){var a=$(t),e={top:20,right:15,bottom:35,left:60},r=a.width()-e.left-e.right,n=Math.max(275-e.top-e.bottom,Math.min(Math.ceil(1.1*r)-e.top-e.bottom,windowHeight-100-e.top-e.bottom));a.empty();var i=d3.select(t).append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");data=data_main.jointimpact;var o=["pop_baseline","pop_jointimpact"],c=["No policy changes","All recommended reforms"],s=d3.scale.linear().domain([0,22e4]).range([n,0],.1),l=d3.scale.linear().domain(d3.extent(data,function(t){return t.year})).range([0,r]),d=d3.svg.axis().scale(l).orient("bottom").tickFormat(function(t){return formatYear(t)}).ticks(5),u=d3.svg.axis().scale(s).tickSize(-r).ticks(5).orient("left"),p=i.append("g").attr("class","y axis").call(u);p.selectAll("text").attr("dx",-8),p.selectAll("g").filter(function(t){return t}).classed("minor",!0),i.append("text").attr("class","axistitle").attr("text-anchor","start").attr("x",-e.left).attr("y",-5).text("Federal prison population");var f=(i.append("g").attr("class","x axis-show").attr("transform","translate(0,"+n+")").call(d),d3.svg.line().interpolate("cardinal").x(function(t){return l(t.year)}).y(function(t){return s(t.number)})),h=o.map(function(t){return{name:t,values:data.map(function(a){return{year:a.year,number:+a[t]}})}}),m=i.selectAll(".chartline").data(h).enter().append("g").attr("class","chartline");m.append("path").attr("class",function(t){return t.name}).attr("d",function(t){return f(t.values)}),m.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-1]}}).attr("class","pointlabel").attr("text-anchor","end").attr("x",function(t){return l(t.value.year)}).attr("y",function(t){return"pop_baseline"==t.name?s(t.value.number)-15:s(t.value.number)+15}).text(function(t,a){return c[a]})}var map_data_url="data/judicialdistricts.json",main_data_url="data/data.json",data_main,data,VALUE,districts,windowHeight,containerWidth,isMobile,resizeTimer,drawgraphs,$graphic1=$("#graphic1"),$graphic2=$("#graphic2"),$graphic3=$("#graphic3"),drug2014=95305,MANDMINLABELS=["Sentenced with mandatory minimum","Granted relief at sentencing","Not subject to mandatory minimum"],circleradius=10,blue5=["#b0d5f1","#82c4e9","#1696d2","#00578b","#00152A"],BREAKS=[1e3,1500,2e3,3e3],LEGENDBREAKS=[250,1e3,1500,2e3,3e3,13e3],GROWTHTYPE="total",RACEORDER=["other","white","black","hispanic"],FOOTNOTE="The total federal prison population includes a small share of special populations, such as pretrial holds and those convicted of DC Code felonies. This feature focuses on the federally sentenced population only, in the years for which we have data, 1994–2014.",MAPNOTE="This map shows the number of people sentenced in each federal judicial district and the location of all federal prisons, including privately operated prisons. Yellow lines indicate the distance between a district and a prison housing at least 15 people sentenced in that district. The size of each circle is proportional to the total number of people housed in that facility in fiscal year 2014, from the smallest (103 people) to the largest (6,731 people).",dispatch=d3.dispatch("rescaleXAxis","rescaleYAxis","rescaleYAxis1","rescaleStandingLine","intoGrowthLines","changeGrowthLines","intoChBars","changeChBars","intoSecurityBars","changeSecurityBars");$(".styled-select").click(function(){var t=$(this).children("select")[0],a=!1;if(document.createEvent){var e=document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a=t.dispatchEvent(e)}else t.fireEvent&&(a=t.fireEvent("onmousedown"));a||alert("It didn't worked in your browser.")});var isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;isFirefox&&$(".styled-select select").css("pointer-events","visible"),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$('input:radio[name="radio-growth"]').change(function(){GROWTHTYPE=$(this).val(),"total"!=GROWTHTYPE&&d3.select(".graph0.standing.chartline").attr("opacity",0),dispatch.changeGrowthLines($(this).val())}),d3.select("#select-growth").on("change",function(){dispatch.changeGrowthLines(d3.select(this).property("value"))}),$('input:radio[name="radio-ch"]').change(function(){dispatch.changeChBars($(this).val())}),d3.select("#select-ch").on("change",function(){dispatch.changeChBars(d3.select(this).property("value"))}),$('input:radio[name="radio-security"]').change(function(){dispatch.changeSecurityBars($(this).val())}),d3.select("#select-security").on("change",function(){dispatch.changeSecurityBars(d3.select(this).property("value"))}),$(document).ready(function(){function t(){if(containerWidth-$("#container1").width()!=0){if(containerWidth=$("#container1").width(),$(window).innerWidth()<768){var t=function(){mobileGrowth("#mobilegrowth"),mobileDrivers("#mobiledrivers"),mobileOffense("#mobileoffense"),mobileMm("#mobilemm"),mobileYears("#mobileyears"),mobileMap("#mobilemap"),mobileRace("#mobilerace"),mobileCh("#mobilech"),mobileSecurity("#mobilesecurity"),mobileConclusion("#mobileconclusion"),d3.selectAll("svg").selectAll("*").attr("opacity",1)};isMobile||(isMobile=!0)}else if($(window).innerWidth()>=768){console.log($("#graphic1").width());var t=function(){graph1(),graph2(),graph3()};isMobile&&(isMobile=!1)}t()}}if(containerWidth=$("#container1").width(),windowHeight=$(window).innerHeight(),$(window).innerWidth()<768){isMobile=!0;var a=function(){mobileGrowth("#mobilegrowth"),mobileDrivers("#mobiledrivers"),mobileOffense("#mobileoffense"),mobileMm("#mobilemm"),mobileYears("#mobileyears"),mobileMap("#mobilemap"),mobileRace("#mobilerace"),mobileCh("#mobilech"),mobileSecurity("#mobilesecurity"),mobileConclusion("#mobileconclusion")}}else{isMobile=!1;var a=function(){graph1(),graph2(),graph3()}}$(window).load(function(){Modernizr.svg&&d3.json(main_data_url,function(e){d3.json(map_data_url,function(r){data_main=e,districts=r,a(),window.onresize=function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){t()},250)}})})})});var mainyears=[1994,1998,2002,2006,2010,2014];